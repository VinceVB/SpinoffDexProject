#:kivy 1.11.1
#:import NoTransition kivy.uix.screenmanager.NoTransition
#:import v variables
<Button>:
    font_name: 'Rounded_Elegance.ttf'
<Label>:
    font_name: 'Rounded_Elegance.ttf'
<Screen>:
    canvas.before:
        Color:
            rgba: 1,1,1,1
        Rectangle:
            size: self.size
            pos: self.pos

<SpinoffDex>:
    manager: manager
    dex_page: dex_page
    theGrid: theGrid
    general_image: general_image
    md_ability: md_ability
    md_joined: md_joined
    md_body_size: md_body_size
    md_location: md_location
    md_layout: md_layout
    md_get_rate: md_get_rate
    md_gummis_box: md_gummis_box
    md_evo_box: md_evo_box
    md_moves_names: md_moves_names
    md_moves_levels: md_moves_levels
    md_tm_nrs: md_tm_nrs
    md_tm_names: md_tm_names

    ScreenManager:
        id: manager
        transition: NoTransition()
        Screen:
            name: 'dex_list'
            BoxLayout:
                orientation: 'vertical'
                RelativeLayout:
                    size_hint_y: 0.25
                    Button:
                        id: 'general_image'
                        text: 'Top'
                        on_press:
                            manager.current = 'empty'

                ScrollView:
                    size_hint_y: 0.75

                    scroll_type: ['bars', 'content']
                    bar_width : '10dp'
                    bar_color: 0.4, 0.6, 0.4, 0.8
                    bar_inactive_color: 0.4, 0.6, 0.4, 0.3
                    GridLayout:
                        id: theGrid
                        cols: 1
                        orientation: 'vertical'
                        size_hint_y: None
                        size: root.width, self.minimum_height
                        row_default_height: '80dp'
                        spacing: 10
                        padding: 10

        Screen:
            id: dex_page
            name: 'dex_page'
            number:

            on_pre_enter:

                #id.text = app.root.read_csv(self.number, 1)
                #nr.text = app.root.read_csv(self.number, 2)
                #name.text = app.root.read_csv(self.number, 3)
                general_nr_name.text = str(app.root.read_csv(self.number, 2)) + ' ' + str(app.root.read_csv(self.number, 3))
                app.root.check_joined(general_nr_name.text[1:4]) # Set image to joined if pokemon is joined
                general_image.source = 'img\\portraits\\'+general_nr_name.text[1:4]+'.png'  # General Image

                #japanese_name.text = app.root.read_csv(self.number, 4)
                general_type1.text = app.root.read_csv(self.number, 5)                      # Type 1
                general_type2.text = app.root.read_csv(self.number, 6)                      # Type 2
                md_joined.source = app.root.check_joined(general_nr_name.text[1:4])         # Joined
                general_favorite.text = app.root.read_csv(self.number, 8)                   # Favorite?
                general_class.text = app.root.read_csv(self.number, 9)                      # Classification
                general_weight_kg.text = str(app.root.read_csv(self.number, 10))            # Weight (Metric)
                #weight_lbs.text = app.root.read_csv(self.number, 11)
                general_height_m.text = str(app.root.read_csv(self.number, 12))             # Height (Metric)
                #height_ft.text = app.root.read_csv(self.number, 13)
                app.root.set_abilities(app.root.read_csv(self.number, 14))                  # Abilities
                app.root.set_evos(general_nr_name.text[1:4])                                # Evolution Chain
                md_body_size.source = app.root.set_md_body_size(general_nr_name.text[1:4])  # Body size
                md_friend_area.text = app.root.read_csv(self.number, 17)                    # MD Friend Area
                md_get_rate.text = app.root.read_csv(self.number, 18)                       # MD Get rate
                app.root.unown_check(general_nr_name.text[1:4])                             # Check if Unown (Change font size for get rate, it has 2)

                app.root.set_gummis(general_nr_name.text[1:4])                              # Set favourite gummis

                md_location.text = app.root.set_location(general_nr_name.text[1:4])         # MD Location
                #rg_browser_no.text = app.root.read_csv(self.number, 20)
                #rg_location.text = app.root.read_csv(self.number, 21)
                #rg_pkmn_assist.text = app.root.read_csv(self.number, 22)
                #rg_type_group.text = app.root.read_csv(self.number, 23)
                #rg_field_ability.text = app.root.read_csv(self.number, 24)
                #tz_get_rate.text = app.root.read_csv(self.number, 25)
                #dex_page_tz_location.text = app.root.read_csv(self.number, 26)

                app.root.set_moves(general_nr_name.text[1:4])

            ScrollView:
                size_hint_y: 1
                GridLayout:
                    cols: 1
                    orientation: 'vertical'
                    size_hint_y: None
                    size: root.width, self.minimum_height
                    row_default_height: '40dp'
                    spacing: 10
                    padding: 0
                    Button:
                        id: dex_list_back
                        text: 'Back'
                        size_hint_y: 0.1
                        on_press:
                            manager.current = 'dex_list'

                    # ======================================== #
                    # GENERAL INFO                             #
                    # ======================================== #
                    GridLayout:
                        cols: 1
                        size_hint: None, None
                        size: root.width, self.minimum_height
                        spacing: 0
                        padding: 0

                        canvas:
                            Color:
                                rgba: 0.4, 0.6, 0.4, 1
                            Rectangle:
                                size: self.size
                                pos: self.pos

                        BoxLayout:
                            # 55dp
                            size_hint: None, None
                            size: root.width, dp(55)
                            Label:
                                id: general_label
                                size_hint: None, None
                                size: root.width, self.parent.height
                                text: 'General Info'
                                color: 1, 1, 1, 1
                                font_size: '16sp'
                        BoxLayout:
                            #60dp
                            size_hint: None, None
                            size: root.width, dp(60)
                            orientation: 'horizontal'
                            Image:
                                id: general_image
                                size: root.width*0.25, self.parent.height
                                allow_stretch: 'True'
                            Button:
                                id: general_nr_name
                                size_hint: None, None
                                size: root.width*0.5, self.parent.height
                                font_size: '18sp'
                            # Type 1 & Type 2
                            BoxLayout:
                                size_hint: None, None
                                size: root.width*0.25, self.parent.height/2
                                orientation: 'vertical'
                                Button:
                                    id: general_type1
                                    size_hint: None, None
                                    size: self.parent.width, self.parent.height
                                Button:
                                    id: general_type2
                                    size_hint: None, None
                                    size: self.parent.width, self.parent.height
                        BoxLayout:
                            # 50dp
                            size_hint: None, None
                            size: root.width, dp(50)
                            # Height & Weight
                            BoxLayout:
                                size_hint: None, None
                                size: root.width*0.25, self.parent.height
                                orientation: 'vertical'
                                Button:
                                    id: general_height_m
                                    size_hint: None, None
                                    size: self.parent.width, self.parent.height/2
                                    font_size: '12sp'
                                Button:
                                    id: general_weight_kg
                                    size_hint: None, None
                                    size: self.parent.width, self.parent.height/2
                                    font_size: '12sp'
                            Button:
                                id: general_class
                                size_hint: None, None
                                size: root.width*0.5, self.parent.height
                                font_size: '12sp'
                            Button:
                                id: general_favorite
                                size_hint: None, None
                                size: root.width*0.25, self.parent.height
                                font_size: '10sp'
                                on_release:
                                    print(md_get_rate.size)
                                    print(md_get_rate.pos)
                                    print('self.parent.height', md_get_rate.parent.height, 'self.height', md_get_rate.height, md_get_rate.height/md_get_rate.parent.height)


#                    BoxLayout:
#                        # Spacing
#                        size_hint: None, None
#                        size: root.width, '0dp'

                    # ======================================== #
                    # MYSTERY DUNGEON INFO                     #
                    # ======================================== #
                    GridLayout:


                        cols: 1
                        id: md_layout
                        size_hint: None, None
                        size: root.width, self.minimum_height
                        # md_1_box.size[1]+md_2_box.size[1]+md_3_box.size[1]+md_4_box.size[1]+md_5_box.size[1]+md_6_box.size[1]+md_7_box.size[1]+md_8_box.size[1]+md_9_box.size[1]+md_10_box.size[1]+md_11_box.size[1]

                        canvas:
                            Color:
                                rgba: 0.4, 0.4, 0.6, 1
                            Rectangle:
                                size: self.size
                                pos: self.pos

                        # Top Label
                        BoxLayout:
                            id: md_1_box
                            size_hint: None, None
                            size: root.width, '55dp'
                            Label:
                                id: md_label_top
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                text: 'Mystery Dungeon Info'
                                color: 1, 1, 1, 1
                                font_size: '16sp'

                        # Body Size, Recruit Rate, and Joined Labels
                        BoxLayout:
                            id: md_2_box
                            size_hint: None, None
                            size: root.width, '36dp'
                            Label:
                                id: md_label_body_size
                                text:'Body Size'
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                                font_size: '12sp'
                            Label:
                                id: md_label_get_rate
                                text:'Recruit\nRate'
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                                font_size: '12sp'
                            Label:
                                id: md_label_joined
                                text:'Joined\nTeam'
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                                font_size: '12sp'
                            Label:
                                id: md_label_gummis
                                text:'Favourite\nGummis'
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                                font_size: '12sp'

                        # Body Size, Recruit Rate, Joined and Gummis
                        BoxLayout:
                            id: md_3_box
                            size_hint: None, None
                            size: root.width, '45dp'
                            Image:
                                id: md_body_size
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                            Button:
                                id: md_get_rate
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                            ImageButton:
                                id: md_joined
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                                allow_stretch: True
                                on_release:
                                    app.root.md_join(general_nr_name.text[1:4])
                            BoxLayout:
                                id: md_gummis_box
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                                orientation: 'vertical'

                        BoxLayout:
                            id: md_4_box
                            size_hint: None, None
                            size: root.width, '36dp'
                            Label:
                                id: md_label_friend_area
                                text: 'Friend Area'
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                font_size: '12sp'
                        BoxLayout:
                            id: md_5_box
                            size_hint: None, None
                            size: root.width, '35dp'
                            Button:
                                id: md_friend_area
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                font_size: '14sp'
                                background_normal: 'img\\friend areas\\' + md_friend_area.text +'.png'
                                on_release:
                                    app.root.popup('image_' + md_friend_area.text, 'img\\friend areas\\' + md_friend_area.text +'.png')


                        BoxLayout:
                            id: md_6_box
                            size_hint: None, None
                            size: root.width, '36dp'
                            Label:
                                id: md_label_md_ability
                                text: 'Ability'
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                font_size: '12sp'
                        BoxLayout:
                            id: md_7_box
                            size_hint: None, None
                            size: root.width, '45dp'
                            BoxLayout:
                                id: md_ability
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                        BoxLayout:
                            id: md_8_box
                            size_hint: None, None
                            size: root.width, '36dp'
                            Label:
                                id: md_label_location
                                text: 'Location'
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                font_size: '12sp'
                        BoxLayout:
                            id: md_location
                            orientation: 'vertical'
                            size_hint: None, None
                            size: root.width, self.minimum_height

                        BoxLayout:
                            id: md_10_box
                            size_hint: None, None
                            size: root.width, '36dp'
                            Label:
                                id: md_label_evolution_chain
                                text: 'Evolution Chain'
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                font_size: '12sp'
                        BoxLayout:
                            id: md_11_box
                            size_hint: None, None
                            size: root.width, self.minimum_height
                            GridLayout:
                                id: md_evo_box
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                canvas.before:
                                    Rectangle:
                                        pos: self.pos
                                        size: self.size
                                        source: 'img\\misc\\bg_gray7.png'

                    # ============================= #
                    # MD MOVESET                    #
                    # ============================= #
                    GridLayout:
                        id: md_moves_layout
                        size_hint: None, None
                        size: root.width, self.minimum_height
                        cols: 1

                        canvas:
                            Color:
                                rgba: 0.7, 0.4, 0.5, 1
                            Rectangle:
                                size: self.size
                                pos: self.pos

                        BoxLayout:
                            size_hint: None, None
                            size: self.parent.width, '55dp'
                            Label:
                                text: 'Moves Learned'
                                color: 1, 1, 1, 1
                        BoxLayout:
                            size_hint: None, None
                            size: self.parent.width, self.minimum_height
                            orientation: 'horizontal'
                            # Moves
                            BoxLayout:
                                id: md_moves_levels
                                size_hint: None, None
                                size: self.parent.width/2, self.minimum_height
                                orientation: 'vertical'

                            # Levels
                            BoxLayout:
                                id: md_moves_names
                                size_hint: None, None
                                size: self.parent.width/2, self.minimum_height
                                orientation: 'vertical'

                    # ============================= #
                    # MD TM/HM/DM                   #
                    # ============================= #
                    GridLayout:
                        id: md_tms_layout
                        size_hint: None, None
                        size: root.width, self.minimum_height
                        cols: 1

                        canvas:
                            Color:
                                rgba: 0.4, 0.7, 0.5, 1
                            Rectangle:
                                size: self.size
                                pos: self.pos

                        BoxLayout:
                            size_hint: None, None
                            size: self.parent.width, '55dp'
                            Label:
                                text: 'TMs/HMs'
                                color: 1, 1, 1, 1
                        BoxLayout:
                            size_hint: None, None
                            size: self.parent.width, self.minimum_height
                            orientation: 'horizontal'
                            # Moves
                            BoxLayout:
                                id: md_tm_nrs
                                size_hint: None, None
                                size: self.parent.width/2, self.minimum_height
                                orientation: 'vertical'

                            # Levels
                            BoxLayout:
                                id: md_tm_names
                                size_hint: None, None
                                size: self.parent.width/2, self.minimum_height
                                orientation: 'vertical'

        Screen:

            name: 'empty'
            Image:
                source: 'img\\misc\\pokeball.png'

<DexEntry>
    cols:4
    rows:2
    on_press:
        app.root.dex_page.number = int(self.id[3:])
        app.root.manager.current = 'dex_page'