#:kivy 1.11.1
#:import NoTransition kivy.uix.screenmanager.NoTransition
#:import v variables
<Button>:
    font_name: 'Rounded_Elegance.ttf'
<Label>:
    font_name: 'Rounded_Elegance.ttf'
<Screen>:
    canvas.before:
        Color:
            rgba: 1,1,1,1
        Rectangle:
            size: self.size
            pos: self.pos

<Separator_x@Widget>
    size_hint: None, None
    size: self.parent.width, dp(2)
    canvas:
        Color:
            rgba: 1, 1, 1, 0.2
        Rectangle:
            size: self.size
            pos: self.pos

<Separator_y@Widget>
    size_hint: None, None
    size: dp(2), self.parent.height
    canvas:
        Color:
            rgba: 1, 1, 1, 0.2
        Rectangle:
            size: self.size
            pos: self.pos

# Define your background color Template
<BackgroundColor@Widget>
    background_color: 1, 1, 1, 1
    canvas.before:
        Color:
            rgba: root.background_color
        Rectangle:
            size: self.size
            pos: self.pos
# Now you can simply Mix the `BackgroundColor` class with almost
# any other widget... to give it a background.
<BackgroundLabel@Label+BackgroundColor>
    background_color: 0, 0, 0, 0
    # Default the background color for this label
    # to r 0, g 0, b 0, a 0

<DexEntry>
    cols:2
    on_press:
        app.root.dex_list_scroller.previous_y = app.root.dex_list_scroller.scroll_y  # Remember position in scroller to return to later
        app.root.dex_page_main.number = int(self.page[3:])
        app.root.manager.current = 'dex_page_main'

<SpinoffDex>:
    manager: manager
    dex_page_main: dex_page_main
    theGrid: theGrid
    general_image: general_image
    md_abilities: md_abilities
    md_ability1: md_ability1
    md_ability2: md_ability2
    md_ability_sep: md_ability_sep
    md_joined: md_joined
    md_body_size: md_body_size
    md_location: md_location
    md_layout: md_layout
    md_get_rate: md_get_rate
    md_get_rate2: md_get_rate2
    md_gummis_box: md_gummis_box
    md_evo_box: md_evo_box
    md_moves_names: md_moves_names
    md_moves_levels: md_moves_levels
    md_tm_nrs: md_tm_nrs
    md_tm_names: md_tm_names
    general_type1: general_type1
    general_type2: general_type2
    type_box: type_box
    dex_list_scroller: dex_list_scroller
    dex_searchbar: dex_searchbar
    dex_base_stats: dex_base_stats

    ScreenManager:
        id: manager
        transition: NoTransition()
        Screen:
            name: 'dex_list'
            on_pre_enter:
                # Go to position in ScrollView where user entered
                app.root.dex_list_scroller.scroll_y = app.root.dex_list_scroller.previous_y

            BoxLayout:
                orientation: 'vertical'
                BoxLayout:
                    size_hint_y: 0.075
                    orientation: 'vertical'

                    # Top / Bottom Buttons
                    BoxLayout:
                        orientation: 'horizontal'
                        Button:
                            text: 'Top'
                            on_press:
                                app.root.dex_list_scroller.scroll_y = 1
                        Button:
                            text: 'Bottom'
                            on_press:
                                app.root.dex_list_scroller.scroll_y = 0

                    # Search Bar
                    BoxLayout:
                        TextInput:
                            id: dex_searchbar
                            hint_text:'Enter Pokedex Nr / Pokemon Name'
                            multiline: False

                            on_text_validate:
                                app.root.dex_search(self.text)
                                #app.root.open


                ScrollView:
                    id: dex_list_scroller
                    size_hint_y: 0.75
                    previous_y: 1
                    scroll_type: ['bars', 'content']
                    bar_width : '10dp'
                    bar_color: 0.4, 0.7, 0.4, 1.0
                    bar_inactive_color: 0.4, 0.7, 0.4, 0.4

                    GridLayout:
                        id: theGrid
                        cols: 1
                        orientation: 'vertical'
                        size_hint_y: None
                        size: root.width, self.minimum_height
                        row_default_height: '85dp'
                        spacing: 10   # between elements - 1720/0 1910/10 2100/20
                        padding: 10  # around elements

        Screen:
            id: dex_page_main
            name: 'dex_page_main'
            number:

            on_pre_enter:

                #id.text = app.root.read_csv(self.number, 1)
                #nr.text = app.root.read_csv(self.number, 2)
                #name.text = app.root.read_csv(self.number, 3)
                general_nr_name.text = str(app.root.read_csv(self.number, 2)) + ' ' + str(app.root.read_csv(self.number, 3))
                app.root.check_joined(general_nr_name.text[1:4]) # Set image to joined if pokemon is joined
                general_image.source = 'img\\portraits\\'+general_nr_name.text[1:4]+'.png'  # General Image

                #japanese_name.text = app.root.read_csv(self.number, 4)
                app.root.set_types(general_nr_name.text[1:4])                               # Type 1 (/ Type 2)
                md_joined.source = app.root.check_joined(general_nr_name.text[1:4])         # Joined
                #general_favorite.text = app.root.read_csv(self.number, 8)                  # Favorite?
                general_class.text = app.root.read_csv(self.number, 9)                      # Classification
                general_weight.text = str(app.root.read_csv(self.number, 10) + ' - ' + app.root.read_csv(self.number, 11))            # Weight (Metric)
                #general_weight_lbs.text = app.root.read_csv(self.number, 11)
                general_height.text = str(app.root.read_csv(self.number, 12) + ' - ' + app.root.read_csv(self.number, 13))             # Height (Metric)
                #general_height_ft.text = app.root.read_csv(self.number, 13)
                app.root.set_stats(general_nr_name.text[1:4])                               # Base Stats
                app.root.set_abilities(app.root.read_csv(self.number, 14))                  # Abilities
                app.root.set_evos(general_nr_name.text[1:4])                                # Evolution Chain
                md_body_size.source = app.root.set_md_body_size(general_nr_name.text[1:4])  # Body size
                md_friend_area.text = app.root.read_csv(self.number, 17)                    # MD Friend Area
                md_get_rate.text = app.root.read_csv(self.number, 18)                       # MD Get rate
                md_get_rate2.text = app.root.read_csv(self.number, 36) [1:-1]               # MD Get rate min levels
                app.root.unown_check(general_nr_name.text[1:4])                             # Check if Unown (Change font size for get rate, it has 2)

                app.root.set_gummis(general_nr_name.text[1:4])                              # Set favourite gummis

                md_location.text = app.root.set_location(general_nr_name.text[1:4])         # MD Location
                #rg_browser_no.text = app.root.read_csv(self.number, 20)
                #rg_location.text = app.root.read_csv(self.number, 21)
                #rg_pkmn_assist.text = app.root.read_csv(self.number, 22)
                #rg_type_group.text = app.root.read_csv(self.number, 23)
                #rg_field_ability.text = app.root.read_csv(self.number, 24)
                #tz_get_rate.text = app.root.read_csv(self.number, 25)
                #dex_page_tz_location.text = app.root.read_csv(self.number, 26)

                app.root.set_moves(general_nr_name.text[1:4])

            ScrollView:
                size_hint_y: 0.95
                pos_hint: {"y":0.05}
                GridLayout:
                    cols: 1
                    orientation: 'vertical'
                    size_hint_y: None
                    size: root.width, self.minimum_height
                    row_default_height: '40dp'
                    spacing: 10
                    padding: 0
                    Button:
                        id: dex_list_back
                        text: 'Back'
                        size_hint_y: 0.1
                        on_press:
                            manager.current = 'dex_list'

                    # ======================================== #
                    # GENERAL INFO                             #
                    # ======================================== #
                    GridLayout:
                        cols: 1
                        size_hint: None, None
                        size: root.width, self.minimum_height
                        spacing: 0
                        padding: 0

                        canvas:
                            Color:
                                rgba: 0.4, 0.6, 0.4, 1
                            Rectangle:
                                size: self.size
                                pos: self.pos
                        Separator_x:
                        BoxLayout:
                            size_hint: None, None
                            size: root.width, dp(55)

                            canvas:
                                Color:
                                    rgba: 1, 1, 1, 0.1
                                Rectangle:
                                    size: self.size
                                    pos: self.pos
                            Label:
                                id: general_label
                                size_hint: None, None
                                size: root.width, self.parent.height
                                text: 'General Info'
                                color: 1, 1, 1, 1
                                font_size: '16sp'
                        Separator_x:

                        BoxLayout:
                            size_hint: None, None
                            size: root.width, dp(60)
                            orientation: 'horizontal'
                            Image:
                                id: general_image
                                size: root.width*0.25, self.parent.height
                                #allow_stretch: 'True'
                            BoxLayout:
                                orientation: 'vertical'
                                size_hint: None, None
                                size: root.width*0.5, self.parent.height
                                Label:
                                    id: general_nr_name
                                    size_hint: None, None
                                    size: self.parent.width, self.parent.height*0.5
                                    text_size: self.size
                                    halign: 'center'
                                    valign: 'bottom'
                                    font_size: '16sp'
                                Label:
                                    id: general_class
                                    size_hint: None, None
                                    size: self.parent.width, self.parent.height*0.5
                                    text_size: self.size
                                    halign: 'center'
                                    valign: 'center'
                                    font_size: '12sp'
                            # Type 1 & Type 2
                            # Double BoxLayout to enable 'center_y' in the inner Box, as the outer is horizontally oriented
                            BoxLayout:
                                orientation: 'horizontal'
                                BoxLayout:
                                    id: type_box
                                    size_hint: None, None
                                    size: root.width*0.25, self.parent.height*0.65
                                    orientation: 'vertical'
                                    pos_hint: {'center_y': 0.5}

                                    BackgroundLabel:
                                        id: general_type1
                                        size_hint: None, None
                                        size: self.parent.width-5, self.parent.height/2
                                    BackgroundLabel:
                                        id: general_type2
                                        size_hint: None, None
                                        size: self.parent.width-5, self.parent.height/2

                        Separator_x:
                        BoxLayout:
                            size_hint: None, None
                            size: root.width, dp(24)
                            Label:
                                text: 'Height'
                                font_size: '12sp'
                            Separator_y:
                            Label:
                                text: 'Weight'
                                font_size: '12sp'

                        # Height & Weight
                        BoxLayout:
                            size_hint: None, None
                            size: root.width, dp(18)
                            Label:
                                id: general_height
                                font_size: '12sp'
                                text_size: self.size
                                halign: 'center'
                                valign: 'top'
                            Separator_y:
                            Label:
                                id: general_weight
                                font_size: '12sp'
                                text_size: self.size
                                halign: 'center'
                                valign: 'top'

                        Separator_x:
                        BoxLayout:
                            size_hint: (None, None)
                            size: root.width, dp(36)

                            canvas:
                                Color:
                                    rgba: 1, 1, 1, 0.1
                                Rectangle:
                                    size: self.size
                                    pos: self.pos
                            Label:
                                text: 'Base Stats'
                                font_size: '12sp'
                        Separator_x:
                        BoxLayout:
                            orientation: 'horizontal'
                            size_hint: (None, None)
                            size: root.width, dp(24)
                            Label:
                                text:'HP'
                                font_size: '12sp'
                            Label:
                                text:'Att'
                                font_size: '12sp'
                            Label:
                                text:'Def'
                                font_size: '12sp'
                            Label:
                                text:'SpA'
                                font_size: '12sp'
                            Label:
                                text:'SpD'
                                font_size: '12sp'
                            Label:
                                text:'Exp'
                                font_size: '12sp'
                        BoxLayout:
                            id: dex_base_stats
                            orientation: 'horizontal'
                            size_hint: (None, None)
                            size: root.width, dp(24)
                        Separator_x:

                    # ======================================== #
                    # MYSTERY DUNGEON INFO                     #
                    # ======================================== #
                    GridLayout:
                        cols: 1
                        id: md_layout
                        size_hint: None, None
                        size: root.width, self.minimum_height
                        canvas:
                            Color:
                                rgba: 0.4, 0.4, 0.6, 1
                            Rectangle:
                                size: self.size
                                pos: self.pos

                        Separator_x:
                        # Top Label
                        BoxLayout:
                            id: md_1_box
                            size_hint: None, None
                            size: root.width, '55dp'

                            canvas:
                                Color:
                                    rgba: 1, 1, 1, 0.1
                                Rectangle:
                                    size: self.size
                                    pos: self.pos
                            Label:
                                id: md_label_top
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                text: 'Mystery Dungeon Info'
                                color: 1, 1, 1, 1
                                font_size: '16sp'
                        Separator_x:

                        # Body Size, Recruit Rate, and Gummi Labels
                        BoxLayout:
                            id: md_2_box
                            size_hint: None, None
                            size: root.width, '36dp'
                            Label:
                                id: md_label_body_size
                                text:'Body Size'
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                                font_size: '12sp'
                            Separator_y:
                            Label:
                                id: md_label_get_rate
                                text:'Recruit\nRate'
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                                font_size: '12sp'
                            Separator_y:
                            Label:
                                id: md_label_joined
                                text:'Joined\nTeam'
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                                font_size: '12sp'
                            Separator_y:
                            Label:
                                id: md_label_gummis
                                text:'Favourite\nGummis'
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                                font_size: '12sp'
                        Separator_x:
                        # Body Size, Recruit Rate, Joined and Gummis
                        BoxLayout:
                            id: md_3_box
                            size_hint: None, None
                            size: root.width, '45dp'
                            Image:
                                id: md_body_size
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                            Separator_y:
                            BoxLayout:
                                orientation: 'vertical'
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                                Label:
                                    id: md_get_rate
                                Separator_x:
                                Button:
                                    id: md_get_rate2
                                    font_size: '12sp'
                                    background_color: 0, 0, 0, 0
                                    on_release:
                                        app.root.popup('Minimum Recruit Levels', ('Minimum Level without Friend Bow: ' + app.root.read_csv(dex_page_main.number, 36)[1:].partition('/')[0] + '\nMinimum Level with Friend Bow: ' + app.root.read_csv(dex_page_main.number, 36)[1:].partition('/')[2][:-1]), '12sp')
                            Separator_y:
                            ImageButton:
                                id: md_joined
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                                #allow_stretch: True
                                on_release:
                                    app.root.md_join(general_nr_name.text[1:4])
                            Separator_y:
                            BoxLayout:
                                id: md_gummis_box
                                size_hint: None, None
                                size: self.parent.width/4, self.parent.height
                                orientation: 'vertical'

                        Separator_x:
                        BoxLayout:
                            id: md_4_box
                            size_hint: None, None
                            size: root.width, '36dp'

                            canvas:
                                Color:
                                    rgba: (1, 1, 1, 0.1)
                                Rectangle:
                                    size: self.size
                                    pos: self.pos
                            Label:
                                id: md_label_friend_area
                                text: 'Friend Area'
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                font_size: '12sp'
                        Separator_x:
                        BoxLayout:
                            id: md_5_box
                            size_hint: None, None
                            size: root.width, '30dp'
                            Button:
                                id: md_friend_area
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                font_size: '14sp'
                                background_normal: 'img\\friend areas\\' + md_friend_area.text +'.png'
                                on_release:
                                    app.root.popup('image_' + md_friend_area.text, 'img\\friend areas\\' + md_friend_area.text +'.png')
                        Separator_x:

                        BoxLayout:
                            id: md_6_box
                            size_hint: None, None
                            size: root.width, '36dp'

                            canvas:
                                Color:
                                    rgba: (1, 1, 1, 0.1)
                                Rectangle:
                                    size: self.size
                                    pos: self.pos
                            Label:
                                id: md_label_md_ability
                                text: 'Ability'
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                font_size: '12sp'
                        Separator_x:
                        BoxLayout:
                            id: md_7_box
                            size_hint: None, None
                            size: root.width, '24dp'
                            BoxLayout:
                                id: md_abilities
                                orientation: 'horizontal'
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                Button:
                                    id: md_ability1
                                    font_size: '14sp'
                                    background_color: 0, 0, 0, 0

                                Separator_y:
                                    id: md_ability_sep
                                Button:
                                    id: md_ability2
                                    font_size: '14sp'
                                    background_color: 0, 0, 0, 0

                        Separator_x:
                        BoxLayout:
                            id: md_8_box
                            size_hint: None, None
                            size: root.width, '36dp'

                            canvas:
                                Color:
                                    rgba: (1, 1, 1, 0.1)
                                Rectangle:
                                    size: self.size
                                    pos: self.pos
                            Label:
                                id: md_label_location
                                text: 'Location'
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                font_size: '12sp'
                        BoxLayout:
                            id: md_location
                            orientation: 'vertical'
                            size_hint: None, None
                            size: root.width, self.minimum_height

                        BoxLayout:
                            id: md_10_box
                            size_hint: None, None
                            size: root.width, '36dp'
                            Label:
                                id: md_label_evolution_chain
                                text: 'Evolution Chain'
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                font_size: '12sp'
                        BoxLayout:
                            id: md_11_box
                            size_hint: None, None
                            size: root.width, self.minimum_height
                            GridLayout:
                                id: md_evo_box
                                size_hint: None, None
                                size: self.parent.width, self.parent.height
                                canvas.before:
                                    Rectangle:
                                        pos: self.pos
                                        size: self.size
                                        source: 'img\\misc\\bg_gray7.png'

            # Bottom selection
            BoxLayout:
                size_hint_y: 0.05
                Button:
                    text: 'General'
                    on_release:
                        app.root.manager.current = 'dex_page_main'

                Button:
                    text: 'Moves'
                    on_release:
                        app.root.manager.current = 'dex_page_moves'
                Button:
                    text: 'Stats'
                    on_release:
                        app.root.manager.current = 'dex_page_stats'
                Button:
                    text: 'Quotes'
                    on_release:
                        pass#app.root.manager.current = 'dex_page_quotes'

        # ============ #
        # Moves Screen #
        # ============ #
        Screen:
            id: dex_page_moves
            name: 'dex_page_moves'
            ScrollView:
                size_hint_y: 0.95
                pos_hint: {"y":0.05}
                GridLayout:
                    cols: 1
                    orientation: 'vertical'
                    size_hint_y: None
                    size: root.width, self.minimum_height
                    row_default_height: '40dp'
                    spacing: 10
                    padding: 0
                    Button:
                        id: dex_list_back
                        text: 'Back'
                        size_hint_y: 0.05
                        on_press:
                            manager.current = 'dex_list'


                    # ============================= #
                    # MD MOVESET                    #
                    # ============================= #
                    GridLayout:
                        id: md_moves_layout
                        size_hint: None, None
                        size: root.width, self.minimum_height
                        cols: 1

                        canvas:
                            Color:
                                rgba: 0.7, 0.4, 0.5, 1
                            Rectangle:
                                size: self.size
                                pos: self.pos

                        Separator_x:
                        BoxLayout:
                            size_hint: None, None
                            size: self.parent.width, '55dp'
                            Label:
                                text: 'Moves Learned'
                                color: 1, 1, 1, 1
                        Separator_x:
                        BoxLayout:
                            size_hint: None, None
                            size: self.parent.width, self.minimum_height
                            orientation: 'horizontal'
                            # Moves
                            BoxLayout:
                                id: md_moves_levels
                                size_hint: None, None
                                size: self.parent.width/2, self.minimum_height
                                orientation: 'vertical'

                            # Levels
                            BoxLayout:
                                id: md_moves_names
                                size_hint: None, None
                                size: self.parent.width/2, self.minimum_height
                                orientation: 'vertical'

                    # ============================= #
                    # MD TM/HM/DM                   #
                    # ============================= #
                    GridLayout:
                        id: md_tms_layout
                        size_hint: None, None
                        size: root.width, self.minimum_height
                        cols: 1

                        canvas:
                            Color:
                                rgba: 0.4, 0.7, 0.5, 1
                            Rectangle:
                                size: self.size
                                pos: self.pos

                        Separator_x:
                        BoxLayout:
                            size_hint: None, None
                            size: self.parent.width, '55dp'
                            Label:
                                text: 'TMs/HMs'
                                color: 1, 1, 1, 1
                        Separator_x:
                        BoxLayout:
                            size_hint: None, None
                            size: self.parent.width, self.minimum_height
                            orientation: 'horizontal'
                            # Moves
                            BoxLayout:
                                id: md_tm_nrs
                                size_hint: None, None
                                size: self.parent.width/2, self.minimum_height
                                orientation: 'vertical'

                            # Levels
                            BoxLayout:
                                id: md_tm_names
                                size_hint: None, None
                                size: self.parent.width/2, self.minimum_height
                                orientation: 'vertical'

            # Bottom selection
            BoxLayout:
                size_hint_y: 0.05
                Button:
                    text: 'General'
                    on_release:
                        app.root.manager.current = 'dex_page_main'

                Button:
                    text: 'Moves'
                    on_release:
                        app.root.manager.current = 'dex_page_moves'
                Button:
                    text: 'Stats'
                    on_release:
                        app.root.manager.current = 'dex_page_stats'
                Button:
                    text: 'Quotes'
                    on_release:
                        pass#app.root.manager.current = 'dex_page_quotes'


        Screen:
            id: dex_page_stats
            name: 'dex_page_stats'
            ScrollView:
                size_hint_y: 0.95
                pos_hint: {"y":0.05}
                GridLayout:
                    cols: 1
                    orientation: 'vertical'
                    size_hint_y: None
                    size: root.width, self.minimum_height
                    row_default_height: '40dp'
                    spacing: 10
                    padding: 0
                    Button:
                        id: dex_list_back
                        text: 'Back'
                        size_hint_y: 0.05
                        on_press:
                            manager.current = 'dex_list'

            # Bottom selection
            BoxLayout:
                size_hint_y: 0.05
                Button:
                    text: 'General'
                    on_release:
                        app.root.manager.current = 'dex_page_main'

                Button:
                    text: 'Moves'
                    on_release:
                        app.root.manager.current = 'dex_page_moves'
                Button:
                    text: 'Stats'
                    on_release:
                        app.root.manager.current = 'dex_page_stats'
                Button:
                    text: 'Quotes'
                    on_release:
                        pass#app.root.manager.current = 'dex_page_quotes'